# 08 | 事务到底是隔离的还是不隔离的？

这篇文章实际上讲的是MVCC（多版本并发控制），InnoDB通过MVCC实现了事务的隔离级别。

还有一个概念叫做一致性读视图  consistent read view

每行记录都有多个版本，每个版本有自己的row trx_id，如下图所示。

![](images/08-1.jpeg)

上图中，这一行记录有4个版本，是通过row trx_id区分的。其中这三个箭头就undo log，V1, V2, V3并不物理存在，需要的时候，通过V4，依次执行undo log算出来。

那事务如何记录row trx id呢？

每个事务启动的时候，取系统里面所有活跃的事务，组成一个数组，其中最小的ID记为低水位，系统中当前最大事务+1是高水位。所有事务如下图所示。

![](images/08-2.jpeg)


InnoDB利用所有数据都有多个版本的特性，实现了秒级创建快照。

在下面的例子中，通过版本可以判定出，事务A读不到事务B和事务C的修改。


![](images/08-3.jpeg)


总结事务对其它事务的可见性，规则如下：

- 版本未提交，不可见
- 版本已提交，但是在视图创建后提交的，不可见
- 版本已提交，是在视图创建前提交的，可见。

